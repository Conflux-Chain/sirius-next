{"version":3,"sources":["../../../src/components/Charts/StockChartTemplate.tsx"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from 'react';\nimport Highcharts from 'highcharts/highstock';\nimport HighchartsReact from 'highcharts-react-official';\nimport Exporting from 'highcharts/modules/exporting';\nimport ExportData from 'highcharts/modules/export-data';\nimport useSWR from 'swr';\nimport { sendRequestChart } from '../../utils/request';\nimport StockTitle from './StockTitle';\nimport BreadcrumbNav from './BreadcrumbNav';\nimport ChartOptions from './ChartOptions';\nimport lodash from 'lodash';\nimport {\n  ChartsProps,\n  optsOrigin,\n  defaultLimit,\n  defaultIntervalType,\n  ScopeType,\n  onCombination,\n  ConstructorType,\n} from './config';\n\nExporting(Highcharts);\nExportData(Highcharts);\n\nexport function StockChartTemplate({ options, request }: ChartsProps) {\n  const chart = useRef(null);\n  const [limit, setLimit] = useState(request?.query?.limit || defaultLimit);\n  const [intervalType, setIntervalType] = useState<keyof ScopeType>(\n    (request?.query?.intervalType as keyof ScopeType) || defaultIntervalType,\n  );\n\n  const sendRequestCallback = useCallback(() => {\n    return sendRequestChart({\n      url: request.url,\n      query: {\n        ...request.query,\n        limit: limit || defaultLimit,\n        intervalType: intervalType,\n      },\n    });\n  }, [request.url, request.query, intervalType, limit, defaultLimit]);\n\n  const { data, isLoading } = useSWR(\n    request.url + intervalType + limit,\n    sendRequestCallback,\n    {\n      revalidateOnFocus: false,\n    },\n  );\n\n  const handleCombination: onCombination = (type, limit) => {\n    // @ts-ignore\n    // chart.current?.chart.xAxis[0].setExtremes(null, null);\n\n    if (type) setIntervalType(type);\n    if (limit) setLimit(limit);\n  };\n\n  useEffect(() => {\n    if (isLoading) {\n      // @ts-ignore\n      chart.current?.chart.showLoading();\n    } else {\n      // @ts-ignore\n      chart.current?.chart.hideLoading();\n    }\n  }, [isLoading]);\n\n  const optsOrigins = optsOrigin({ options, request, data });\n  const opts = lodash.merge(optsOrigins, options);\n  opts.intervalType = { value: intervalType };\n  const constructorType = ConstructorType({ options, request });\n  return (\n    <div>\n      {opts.header.breadcrumbShow !== false ? (\n        <BreadcrumbNav breadcrumb={opts.header.breadcrumb}></BreadcrumbNav>\n      ) : (\n        <></>\n      )}\n      {opts.header.titleShow !== false ? (\n        <StockTitle header={opts.header}></StockTitle>\n      ) : (\n        <></>\n      )}\n      <div\n        className=\"bg-[#FFF] relative p-[1.2857rem] rounded-[4px] color-[#333]\"\n        style={{ boxShadow: 'rgba(20, 27, 50, 0.12) 0.8571rem' }}\n      >\n        {opts.header.optionShow !== false ? (\n          <ChartOptions\n            intervalScope={opts.intervalScope}\n            intervalType={intervalType}\n            limit={limit}\n            onCombination={handleCombination}\n          />\n        ) : (\n          <></>\n        )}\n\n        <HighchartsReact\n          constructorType={constructorType}\n          highcharts={Highcharts}\n          options={opts}\n          ref={chart}\n        />\n      </div>\n    </div>\n  );\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAAS,UAAU,WAAW,QAAQ,mBAAmB;AACzD,OAAO,gBAAgB;AACvB,OAAO,qBAAqB;AAC5B,OAAO,eAAe;AACtB,OAAO,gBAAgB;AACvB,OAAO,YAAY;AAKnB,OAAO,YAAY;AAiEX,SAEA,UAFA,KASF,YATE;AAtDR,UAAU,UAAU;AACpB,WAAW,UAAU;AAEd,SAAS,mBAAmB,EAAE,SAAS,QAAQ,GAAgB;AACpE,QAAM,QAAQ,OAAO,IAAI;AACzB,QAAM,CAAC,OAAO,QAAQ,IAAI,SAAS,SAAS,OAAO,SAAS,YAAY;AACxE,QAAM,CAAC,cAAc,eAAe,IAAI;AAAA,IACrC,SAAS,OAAO,gBAAoC;AAAA,EACvD;AAEA,QAAM,sBAAsB,YAAY,MAAM;AAC5C,WAAO,iBAAiB;AAAA,MACtB,KAAK,QAAQ;AAAA,MACb,OAAO;AAAA,QACL,GAAG,QAAQ;AAAA,QACX,OAAO,SAAS;AAAA,QAChB;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH,GAAG,CAAC,QAAQ,KAAK,QAAQ,OAAO,cAAc,OAAO,YAAY,CAAC;AAElE,QAAM,EAAE,MAAM,UAAU,IAAI;AAAA,IAC1B,QAAQ,MAAM,eAAe;AAAA,IAC7B;AAAA,IACA;AAAA,MACE,mBAAmB;AAAA,IACrB;AAAA,EACF;AAEA,QAAM,oBAAmC,CAAC,MAAMA,WAAU;AAIxD,QAAI;AAAM,sBAAgB,IAAI;AAC9B,QAAIA;AAAO,eAASA,MAAK;AAAA,EAC3B;AAEA,YAAU,MAAM;AACd,QAAI,WAAW;AAEb,YAAM,SAAS,MAAM,YAAY;AAAA,IACnC,OAAO;AAEL,YAAM,SAAS,MAAM,YAAY;AAAA,IACnC;AAAA,EACF,GAAG,CAAC,SAAS,CAAC;AAEd,QAAM,cAAc,WAAW,EAAE,SAAS,SAAS,KAAK,CAAC;AACzD,QAAM,OAAO,OAAO,MAAM,aAAa,OAAO;AAC9C,OAAK,eAAe,EAAE,OAAO,aAAa;AAC1C,QAAM,kBAAkB,gBAAgB,EAAE,SAAS,QAAQ,CAAC;AAC5D,SACE,qBAAC,SACE;AAAA,SAAK,OAAO,mBAAmB,QAC9B,oBAAC,yBAAc,YAAY,KAAK,OAAO,YAAY,IAEnD,gCAAE;AAAA,IAEH,KAAK,OAAO,cAAc,QACzB,oBAAC,sBAAW,QAAQ,KAAK,QAAQ,IAEjC,gCAAE;AAAA,IAEJ;AAAA,MAAC;AAAA;AAAA,QACC,WAAU;AAAA,QACV,OAAO,EAAE,WAAW,mCAAmC;AAAA,QAEtD;AAAA,eAAK,OAAO,eAAe,QAC1B;AAAA,YAAC;AAAA;AAAA,cACC,eAAe,KAAK;AAAA,cACpB;AAAA,cACA;AAAA,cACA,eAAe;AAAA;AAAA,UACjB,IAEA,gCAAE;AAAA,UAGJ;AAAA,YAAC;AAAA;AAAA,cACC;AAAA,cACA,YAAY;AAAA,cACZ,SAAS;AAAA,cACT,KAAK;AAAA;AAAA,UACP;AAAA;AAAA;AAAA,IACF;AAAA,KACF;AAEJ;","names":["limit"]}